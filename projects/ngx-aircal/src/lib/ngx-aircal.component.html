<div class="aircal__container">
    <div class="aircal__meta__input__container" *ngIf="!options?.inlineMode">
        <input type="text" class="aircal__meta__input" placeholder="Select Date" [ngModel]="formSelectionText"
            (ngModelChange)="onUserDateRangeInput($event)" [value]="formSelectionText" [disabled]="false" [readonly]="false"
            [ngClass]="{'aircal__meta__input--invalid': options?.indicateInvalidDateRange && invalidDateRange}"
            autocomplete="off" spellcheck="false" autocorrect="off" />
        <button type="button" class="aircal__meta__input__icon aircal__meta__input__icon--opening" [ngClass]="{'aircal__meta__input__icon--opening': !showCalendar, 'aircal__meta__input__icon--closing': showCalendar}" (click)="openCalendar()">{{options?.selectDateText}}</button>
        <button type="button" class="aircal__meta__input__icon aircal__meta__input__icon--alt aircal__meta__input__icon--closing" [ngClass]="{'aircal__meta__input__icon--opening': showCalendar, 'aircal__meta__input__icon--closing': !showCalendar}" (click)="openCalendar()">{{options?.selectDateCloseText}}</button>
    </div>
    
    <div class="aircal" [ngClass]="['aircal__orient--' + getCalendarOrientation(), options?.hasArrow ? 'aircal--' + getArrowBiasClass() + '-bias' : '', options?.hasArrow && !options?.inlineMode ? 'aircal--has-arrow' : '', !options?.backgroundVisible ? 'aircal--transparent' : '']" *ngIf="showCalendar || options?.inlineMode" [ngStyle]="{'width': options?.width, 'height': options?.height}">       
        <div class="aircal__meta aircal__meta__rows">
            <div data-aircal-year-quickset class="aircal__meta__rows" *ngIf="options?.allowQuicksetYear && (yearSelectionPanelOpen && !monthSelectionPanelOpen)"
                (yearSelected)="selectYear($event)" (nextYearChunks)="nextYearChunks($event)" (prevYearChunks)="prevYearChunks($event)"
                [date]="date" [yearChoices]="yearChoices"></div>
        
            <div data-aircal-month-quickset class="aircal__meta__rows" *ngIf="options?.allowQuicksetMonth && (monthSelectionPanelOpen && !yearSelectionPanelOpen)"
                (monthSelected)="selectMonth($event)" [date]="date" [monthChoices]="monthChoices"></div>
        </div>
        
        <section class="aircal__meta aircal__meta__rows--first aircal__meta__rows">
            <div class="aircal__meta__row">
                <div *ngIf="options?.daysSelectedCounterVisible" data-aircal-daysselected [numberOfDaysSelected]="aircal?.numberOfDaysSelected"></div>
            </div>
            <div class="aircal__meta__column aircal__meta__row__shortcuts">
                <div *ngIf="options?.selectionShortcutVisible" data-aircal-select [selectedStartDate]="aircal?.selectedStartDate.day" [selectionShortcuts]="options?.selectionShortcuts"
                    (selectionShortcutChanged)="selectionShortcutChanged($event)"></div>
            </div>
        </section>
    
        <div class="aircal__cal__container">
            <table class="aircal__cal aircal__cal--double">
                <thead>
                    <tr class="aircal__meta">
                        <button type="button" [disabled]="options?.disablePreviousSelection || aircal?.disablePreviousSelection"
                            role="button" (click)="prevMonth()" class="aircal__icon aircal__icon__button aircal__icon__prev"></button>
                        <p class="aircal__text aircal__text__month"><span class="aircal__meta__clickable" [ngClass]="{'aircal__clickable': options?.allowQuicksetMonth}" (click)="toggleMonthSelection()">{{formatDate(date, "MMMM")}}</span>
                        <span class="aircal__meta__clickable" [ngClass]="{'aircal__clickable': options?.allowQuicksetYear}" (click)="toggleYearSelection()">{{formatDate(date, "YYYY")}}</span></p>
                    </tr>
                    <tr class="aircal__meta">
                        <th aircal-aircal-daysofweek class="flex-container aircal__daysofweek" *ngFor="let dayName of ObjectKeys(options.dayLabels)"
                            [dayName]="dayName" [dayLabels]="options?.dayLabels"></th>
                    </tr>
                </thead>
                <tbody class="aircal__cal-body">
                    <tr class="aircal__week" *ngFor="let weeks of daysWeeksArray">
                        <td class="aircal__day__container" *ngFor="let day of weeks" (mouseenter)="isHovering(day)"
                                (mouseleave)="isLeaving(day)" (click)="selectDate(day)" [ngClass]="{'aircal--inactive': (!day || day?.disabled || day?.isLastMonth || day?.isNextMonth),
                                'aircal--highlighted': day?.highlight,
                                'aircal--istoday': isToday(day),
                                'aircal--selected': isSelected(day) && (!day?.isNextMonth || !day?.isLastMonth)}">
                            <div data-aircal-day class="aircal__day" [day]="day"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
            
            <table class="aircal__cal aircal__cal--double">
                <thead>
                    <tr class="aircal__meta">
                        <p class="aircal__text aircal__text__month"><span class="aircal__meta__clickable" [ngClass]="{'aircal__clickable': options?.allowQuicksetMonth}" (click)="toggleMonthSelection()">{{formatDate(nextMonthDate, "MMMM")}}</span>
                        <span class="aircal__meta__clickable" [ngClass]="{'aircal__clickable': options?.allowQuicksetYear}" (click)="toggleYearSelection()">{{formatDate(nextMonthDate, "YYYY")}}</span></p>
                        <button type="button" [disabled]="options?.disableForwardSelection || aircal?.disableForwardSelection" role="button"
                            (click)="nextMonth()" class="aircal__icon aircal__icon__button aircal__icon__next"></button>
                    </tr>
                    <tr class="aircal__meta">
                        <th aircal-aircal-daysofweek class="flex-container aircal__daysofweek" *ngFor="let dayName of ObjectKeys(options.dayLabels)"
                            [dayName]="dayName" [dayLabels]="options?.dayLabels"></th>
                    </tr>
                </thead>
                <tbody class="aircal__cal-body">
                    <tr class="aircal__week" *ngFor="let weeks of nextMonthDaysWeeksArray">
                        <td class="aircal__day__container" *ngFor="let day of weeks" (mouseenter)="isHovering(day)"
                                (mouseleave)="isLeaving(day)" (click)="selectDate(day)" [ngClass]="{'aircal--inactive': (!day || day?.disabled || day?.isLastMonth || day?.isNextMonth),
                                'aircal--highlighted': day?.highlight,
                                'aircal--istoday': isToday(day),
                                'aircal--selected': isSelected(day) && (!day?.isNextMonth || !day?.isLastMonth)}">
                            <div data-aircal-day class="aircal__day" [day]="day"></div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    
        <div class="aircal__actions aircal__meta__rows--last">
            <div>
                <button *ngIf="options?.showClearBtn" type="button" class="aircal__button aircal__button--cancel" [disabled]="!(this.aircal.selectedStartDate?.day && this.aircal.selectedEndDate?.day)"
                    (click)="_dateRangeCleared()">{{options?.clearText}}</button>
            </div>
            <div>
                <button *ngIf="options?.showApplyBtn" type="button" [disabled]="!(this.aircal.selectedStartDate?.day && this.aircal.selectedEndDate?.day) || !needsApplying" class="aircal__button aircal__button--apply"
                    (click)="_dateRangeCommitted()">{{options?.applyText}}</button>
            </div>
        </div>
    </div>
</div>